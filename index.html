<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ•°å­¦ä¿®ä»™ä¼  | åŠ¨æ€äº¤äº’ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700;900&family=Ma+Shan+Zheng&display=swap" rel="stylesheet">
    <style>
        /* --- å…¨å±€é‡ç½®ä¸åŸºç¡€ --- */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Noto Serif SC', serif;
            background: #050a14;
            color: #e2e8f0;
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* --- åŠ¨æ€èƒŒæ™¯ç”»å¸ƒ --- */
        #canvas-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            pointer-events: none; /* é»˜è®¤ä¸æ‹¦æˆªäº‹ä»¶ï¼Œä½†åœ¨JSä¸­ä¼šå¼€å¯ */
        }

        /* --- å¯¼èˆªæ æ ·å¼ --- */
        .nav-container {
            background: rgba(5, 10, 20, 0.8);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(245, 158, 11, 0.1);
            transition: all 0.3s;
        }
        .nav-item {
            position: relative;
            transition: all 0.3s;
        }
        .nav-item::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 0;
            height: 2px;
            background: linear-gradient(90deg, #f59e0b, transparent);
            transition: width 0.3s;
        }
        .nav-item:hover::after, .nav-item.active::after {
            width: 100%;
        }

        /* --- é¡µé¢åˆ‡æ¢åŠ¨ç”» --- */
        .page-section {
            display: none;
            opacity: 0;
            transform: translateY(30px);
            transition: opacity 0.6s cubic-bezier(0.4, 0, 0.2, 1), transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            min-height: 100vh;
            padding-top: 80px;
            padding-bottom: 60px;
            position: relative;
            z-index: 1;
        }
        .page-section.active {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }

        /* --- å¡ç‰‡é«˜çº§åŠ¨æ•ˆ --- */
        .realm-card {
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
            transform-style: preserve-3d;
        }
        
        /* æ‰«å…‰æ•ˆæœ */
        .realm-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(245, 158, 11, 0.15) 0%, transparent 60%);
            opacity: 0;
            transform: scale(0.5);
            transition: all 0.5s;
            pointer-events: none;
        }
        
        .realm-card:hover {
            transform: translateY(-8px) rotateX(2deg);
            border-color: rgba(245, 158, 11, 0.6);
            box-shadow: 0 0 25px rgba(245, 158, 11, 0.2), inset 0 0 15px rgba(245, 158, 11, 0.05);
        }
        .realm-card:hover::before {
            opacity: 1;
            transform: scale(1.2);
        }

        /* --- å‘å…‰æ–‡å­— --- */
        .glow-text {
            text-shadow: 0 0 10px rgba(245, 158, 11, 0.6), 0 0 30px rgba(245, 158, 11, 0.3);
        }

        /* --- æŒ‰é’® --- */
        .btn-primary {
            background: linear-gradient(135deg, #f59e0b, #ef4444);
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
            transition: all 0.3s;
        }
        .btn-primary:hover {
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 8px 25px rgba(245, 158, 11, 0.5);
        }
        
        /* ç‚¹å‡»æ³¢çº¹æ•ˆæœ */
        .ripple {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.4);
            transform: scale(0);
            animation: ripple-effect 0.6s linear;
            pointer-events: none;
        }
        @keyframes ripple-effect {
            to { transform: scale(4); opacity: 0; }
        }

        /* --- æ¨¡æ€æ¡†åŠ¨ç”» --- */
        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.95);
            z-index: 100;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 1rem;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }
        .modal.active {
            opacity: 1;
            pointer-events: auto;
        }
        .modal-content {
            background: #1e293b;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            border-radius: 16px;
            border: 1px solid rgba(255,255,255,0.1);
            position: relative;
            transform: scale(0.8);
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 0 50px rgba(245, 158, 11, 0.1);
        }
        .modal.active .modal-content { transform: scale(1); }

        /* --- å“åº”å¼å¸ƒå±€ --- */
        @media (max-width: 768px) {
            .grid-responsive { grid-template-columns: 1fr !important; }
            .title-main { font-size: 2.5rem; }
        }
    </style>
</head>
<body class="relative">

    <!-- 1. å…¨å±€åŠ¨æ€èƒŒæ™¯ -->
    <canvas id="canvas-bg"></canvas>

    <!-- 2. å¯¼èˆªæ  -->
    <nav class="nav-container fixed top-0 left-0 right-0 z-50">
        <div class="max-w-7xl mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center gap-2 cursor-pointer" onclick="navigateTo('home')">
                <div class="w-10 h-10 rounded-full bg-gradient-to-br from-amber-400 to-red-600 flex items-center justify-center text-white font-bold text-xl shadow-lg" style="font-family: 'Ma Shan Zheng', cursive;">æ•°</div>
                <h1 class="text-xl font-bold text-amber-400 glow-text hidden md:block" style="font-family: 'Ma Shan Zheng', cursive;">æ•°å­¦ä¿®ä»™ä¼ </h1>
            </div>
            
            <div class="flex gap-2 md:gap-6 text-sm items-center">
                <button onclick="navigateTo('home')" class="nav-item active px-2 py-1 text-slate-300 hover:text-white">é¦–é¡µ</button>
                <button onclick="navigateTo('realms')" class="nav-item px-2 py-1 text-slate-300 hover:text-white">å¢ƒç•Œå›¾è°±</button>
                <button onclick="navigateTo('challenge')" class="nav-item px-2 py-1 text-slate-300 hover:text-white">âš”ï¸ æŒ‘æˆ˜</button>
                <button onclick="navigateTo('games')" class="nav-item px-2 py-1 text-slate-300 hover:text-white">ğŸ® æ¸¸æˆ</button>
                <button onclick="navigateTo('profile')" class="nav-item px-2 py-1 text-amber-400 border border-amber-500/30 rounded-full px-3 bg-slate-900/50">
                    Lv.<span id="nav-level">1</span>
                </button>
            </div>
        </div>
    </nav>

    <!-- 3. ä¸»é¡µé¢å®¹å™¨ -->

    <!-- A. é¦–é¡µ -->
    <div id="home" class="page-section active">
        <div class="max-w-5xl mx-auto px-4 flex flex-col items-center justify-center text-center">
            <div class="mb-4 animate-pulse">
                <span class="px-4 py-1 rounded-full bg-amber-500/10 border border-amber-500/30 text-amber-400 text-xs tracking-[0.2em] uppercase">Mathematics Cultivation v3.0</span>
            </div>
            
            <h1 class="title-main text-5xl md:text-7xl font-black mb-4 leading-tight text-transparent bg-clip-text bg-gradient-to-r from-amber-300 via-orange-400 to-red-500 glow-text" style="font-family: 'Ma Shan Zheng', cursive;">
                é—®é“æ•°å­¦ä¹é‡å¤©
            </h1>
            
            <p class="text-slate-400 text-lg md:text-xl max-w-2xl mb-8 leading-relaxed">
                ä»<strong class="text-cyan-300">é«˜ç­‰æ•°å­¦</strong>çš„ç­‘åŸºèµ·æ­¥ï¼Œæ”€ç™»è‡³<strong class="text-red-300">é»æ›¼çŒœæƒ³</strong>çš„æ¸¡åŠ«å·…å³°ã€‚
                <br>è¿™é‡Œæ˜¯çŸ¥è¯†çš„æ®¿å ‚ï¼Œä¹Ÿæ˜¯æŒ‘æˆ˜æ™ºæ…§çš„è¯•ç‚¼åœºã€‚
            </p>
            
            <div class="flex flex-col md:flex-row gap-4 mb-12">
                <button onclick="navigateTo('realms')" class="btn-primary px-8 py-3 rounded-lg font-bold text-white">
                    æµè§ˆå¢ƒç•Œå›¾è°±
                </button>
                <button onclick="navigateTo('challenge')" class="px-8 py-3 border border-amber-500/50 rounded-lg font-bold text-amber-400 hover:bg-amber-500/10 transition-colors flex items-center justify-center gap-2 backdrop-blur-sm">
                    <span>âš”ï¸</span> å¼€å§‹æŒ‘æˆ˜è¯•ç‚¼
                </button>
            </div>

            <!-- ç»Ÿè®¡æ•°å­—æ»šåŠ¨ -->
            <div class="w-full grid grid-cols-2 md:grid-cols-4 gap-4 text-center mb-12">
                <div class="bg-slate-900/50 p-4 rounded-lg border border-slate-800 hover:border-amber-500/30 transition-colors">
                    <div class="text-3xl font-bold text-amber-400" id="stat-realms">0</div>
                    <div class="text-xs text-slate-500">å¤§å¢ƒç•Œ</div>
                </div>
                <div class="bg-slate-900/50 p-4 rounded-lg border border-slate-800 hover:border-amber-500/30 transition-colors">
                    <div class="text-3xl font-bold text-amber-400" id="stat-problems">0</div>
                    <div class="text-xs text-slate-500">ä¸–ç•Œéš¾é¢˜</div>
                </div>
                <div class="bg-slate-900/50 p-4 rounded-lg border border-slate-800 hover:border-amber-500/30 transition-colors">
                    <div class="text-3xl font-bold text-amber-400" id="stat-players">0</div>
                    <div class="text-xs text-slate-500">ä¿®ä»™è€…</div>
                </div>
                <div class="bg-slate-900/50 p-4 rounded-lg border border-slate-800 hover:border-amber-500/30 transition-colors">
                    <div class="text-3xl font-bold text-amber-400">âˆ</div>
                    <div class="text-xs text-slate-500">æ™ºæ…§</div>
                </div>
            </div>

            <!-- æ ¸å¿ƒç‰¹è‰² -->
            <div class="w-full grid grid-responsive md:grid-cols-3 gap-4 text-left">
                <div class="bg-slate-900/50 p-6 rounded-xl border-l-4 border-cyan-500 hover:bg-slate-800/50 transition-all hover:scale-[1.02] cursor-pointer">
                    <h3 class="text-cyan-400 font-bold mb-2 flex items-center gap-2">ğŸ“š å¼€æ”¾çŸ¥è¯†åº“</h3>
                    <p class="text-sm text-slate-400">ä¹å¤§å¢ƒç•Œå®Œå…¨å¼€æ”¾ï¼Œæ— éœ€è§£é”å³å¯æµè§ˆæ‰€æœ‰æ•°å­¦çŸ¥è¯†ï¼Œä»å…¥é—¨åˆ°å…¥åœ£ã€‚</p>
                </div>
                <div class="bg-slate-900/50 p-6 rounded-xl border-l-4 border-purple-500 hover:bg-slate-800/50 transition-all hover:scale-[1.02] cursor-pointer">
                    <h3 class="text-purple-400 font-bold mb-2 flex items-center gap-2">âš”ï¸ è¯•ç‚¼æŒ‘æˆ˜</h3>
                    <p class="text-sm text-slate-400">è‡ªè®¤ä¸ºå­¦æœ‰æ‰€æˆï¼Ÿè¿›å…¥æŒ‘æˆ˜æ¨¡å¼ï¼Œçœ‹çœ‹èƒ½å¦çªç ´é‡å›´ï¼Œè¯å¾—å¤§é“ã€‚</p>
                </div>
                <div class="bg-slate-900/50 p-6 rounded-xl border-l-4 border-red-500 hover:bg-slate-800/50 transition-all hover:scale-[1.02] cursor-pointer">
                    <h3 class="text-red-400 font-bold mb-2 flex items-center gap-2">ğŸ® è¶£å‘³é“åœº</h3>
                    <p class="text-sm text-slate-400">å…¬å¼æ‹¼å›¾ã€æ•°åˆ—æ¨æ¼”...åœ¨æ¸¸æˆä¸­ç£¨ç»ƒæ•°å­¦ç›´è§‰ï¼Œè½»æ¾å¢é•¿ä¿®ä¸ºã€‚</p>
                </div>
            </div>
        </div>
    </div>

    <!-- B. å¢ƒç•Œå›¾è°± -->
    <div id="realms" class="page-section">
        <div class="max-w-7xl mx-auto px-4">
            <div class="text-center mb-12">
                <h2 class="text-4xl font-bold text-amber-400 mb-2 glow-text" style="font-family: 'Ma Shan Zheng', cursive;">æ•°å­¦å¢ƒç•Œå…¨æ™¯å›¾</h2>
                <p class="text-slate-400">ç‚¹å‡»å¡ç‰‡æŸ¥çœ‹è¯¦ç»†å¿ƒæ³•ï¼Œå†…å®¹å…¨å¼€æ”¾</p>
            </div>
            
            <div id="realm-container" class="grid grid-responsive md:grid-cols-3 gap-6">
                <!-- JSç”Ÿæˆ -->
            </div>
        </div>
    </div>

    <!-- C. æŒ‘æˆ˜æ¨¡å¼ -->
    <div id="challenge" class="page-section">
        <div class="max-w-4xl mx-auto px-4">
            <div class="text-center mb-12">
                <h2 class="text-4xl font-bold text-amber-400 mb-2 glow-text" style="font-family: 'Ma Shan Zheng', cursive;">âš”ï¸ ä¿®ä¸ºè¯•ç‚¼åœº</h2>
                <p class="text-slate-400">éªŒè¯ä½ çš„æ•°å­¦æ°´å¹³ï¼Œæ­¥æ­¥é£å‡</p>
                <div class="mt-4 inline-block bg-slate-800 px-4 py-2 rounded-lg border border-amber-500/30 shadow-lg shadow-amber-500/5">
                    å½“å‰å¢ƒç•Œï¼š<span id="current-realm-name" class="text-amber-400 font-bold">ç»ƒæ°”æœŸ</span>
                    <span class="ml-2 text-sm text-slate-400">(ä¿®ä¸º: <span id="user-exp">0</span>)</span>
                </div>
            </div>

            <div id="challenge-list" class="grid grid-responsive md:grid-cols-2 gap-6">
                <!-- JSç”Ÿæˆ -->
            </div>
        </div>
    </div>

    <!-- D. å°æ¸¸æˆé“åœº -->
    <div id="games" class="page-section">
        <div class="max-w-6xl mx-auto px-4">
            <div class="text-center mb-12">
                <h2 class="text-4xl font-bold text-amber-400 mb-2 glow-text" style="font-family: 'Ma Shan Zheng', cursive;">ğŸ® æ‚Ÿé“å°æ¸¸æˆ</h2>
                <p class="text-slate-400">å¯“æ•™äºä¹ï¼Œè½»æ¾å¢é•¿ä¿®ä¸º</p>
            </div>

            <div class="grid grid-responsive md:grid-cols-2 gap-6">
                <div class="bg-slate-800/50 rounded-xl p-6 border border-slate-700 hover:border-amber-500/50 transition-all group cursor-pointer relative overflow-hidden" onclick="startGame('puzzle')">
                    <div class="absolute top-0 left-0 w-full h-1 bg-amber-500 transform scale-x-0 group-hover:scale-x-100 transition-transform duration-500"></div>
                    <div class="flex items-center gap-4 mb-4">
                        <div class="w-12 h-12 rounded-lg bg-amber-500/20 flex items-center justify-center text-amber-400 text-2xl">âˆ‘</div>
                        <div>
                            <h3 class="font-bold text-lg">å…¬å¼æ‹¼å›¾</h3>
                            <p class="text-xs text-slate-400">é‡ç»„ç»å…¸å…¬å¼</p>
                        </div>
                    </div>
                    <p class="text-slate-300 text-sm mb-4">å°†æ‰“ä¹±çš„æ•°å­¦å…¬å¼æŒ‰æ­£ç¡®é¡ºåºæ’åˆ—ã€‚</p>
                </div>

                <div class="bg-slate-800/50 rounded-xl p-6 border border-slate-700 hover:border-blue-500/50 transition-all group cursor-pointer relative overflow-hidden" onclick="startGame('sequence')">
                    <div class="absolute top-0 left-0 w-full h-1 bg-blue-500 transform scale-x-0 group-hover:scale-x-100 transition-transform duration-500"></div>
                    <div class="flex items-center gap-4 mb-4">
                        <div class="w-12 h-12 rounded-lg bg-blue-500/20 flex items-center justify-center text-blue-400 text-2xl">â†¬</div>
                        <div>
                            <h3 class="font-bold text-lg">æ•°åˆ—æ¨æ¼”</h3>
                            <p class="text-xs text-slate-400">å¯»æ‰¾è§„å¾‹</p>
                        </div>
                    </div>
                    <p class="text-slate-300 text-sm mb-4">è§‚å¯Ÿæ•°åˆ—è§„å¾‹ï¼Œé¢„æµ‹ä¸‹ä¸€ä¸ªæ•°å­—ã€‚</p>
                </div>
            </div>

            <!-- æ¸¸æˆè¿›è¡ŒåŒº -->
            <div id="game-area" class="mt-8 hidden"></div>
        </div>
    </div>

    <!-- E. ä¸ªäººä¸­å¿ƒ -->
    <div id="profile" class="page-section">
        <div class="max-w-2xl mx-auto px-4">
            <div class="text-center mb-12">
                <h2 class="text-4xl font-bold text-amber-400 mb-2 glow-text" style="font-family: 'Ma Shan Zheng', cursive;">ä¿®ç‚¼æ¡£æ¡ˆ</h2>
            </div>
            
            <div class="bg-slate-800/50 rounded-xl p-6 border border-slate-700 mb-6 relative overflow-hidden">
                <div class="absolute top-0 right-0 w-32 h-32 bg-amber-500/10 rounded-full blur-3xl"></div>
                <div class="relative z-10">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-bold">é“å·ï¼š<span class="text-amber-400">æ•°å­¦ä¿®å£«</span></h3>
                        <span class="bg-amber-500/20 px-3 py-1 rounded text-amber-300 text-sm">Lv.<span id="profile-level">1</span></span>
                    </div>
                    <div class="mb-4">
                        <div class="flex justify-between text-sm mb-1">
                            <span>å½“å‰ä¿®ä¸º</span>
                            <span id="profile-exp-text">0 / 100</span>
                        </div>
                        <div class="w-full bg-slate-900 rounded-full h-3 overflow-hidden">
                            <div id="profile-exp-bar" class="bg-gradient-to-r from-amber-500 to-red-500 h-3 rounded-full transition-all duration-1000" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4 text-center pt-4 border-t border-slate-700">
                        <div>
                            <div class="text-2xl font-bold text-green-400" id="stat-correct">0</div>
                            <div class="text-xs text-slate-400">æŒ‘æˆ˜æ­£ç¡®æ•°</div>
                        </div>
                        <div>
                            <div class="text-2xl font-bold text-blue-400" id="stat-games">0</div>
                            <div class="text-xs text-slate-400">æ¸¸æˆåœºæ¬¡</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- æ¨¡æ€æ¡† -->
    <div id="modal-detail" class="modal">
        <div class="modal-content p-6 md:p-8">
            <button onclick="closeModal('modal-detail')" class="absolute top-4 right-4 text-slate-400 hover:text-white text-2xl z-10">&times;</button>
            <div id="modal-detail-body"></div>
        </div>
    </div>

    <div id="modal-quiz" class="modal">
        <div class="modal-content p-6 md:p-8 max-w-lg">
            <div id="modal-quiz-body"></div>
        </div>
    </div>

    <script>
        // ================= æ•°æ®å±‚ =================
        const mathData = [
            {
                id: 1, name: "ç»ƒæ°”æœŸ", title: "ç®—æœ¯ä¸é€»è¾‘", color: "#22d3ee",
                desc: "ä¸‡ä¸ˆé«˜æ¥¼å¹³åœ°èµ·ã€‚è™½ç„¶åªæ˜¯åŸºç¡€ç®—æœ¯ï¼Œä½†å…¶ä¸­è•´å«çš„é€»è¾‘æ˜¯æ•°å­¦å¤§é“çš„åŸºçŸ³ã€‚",
                concepts: ["å››åˆ™è¿ç®—", "æ•°åˆ—åŸºç¡€", "é€»è¾‘æ¨ç†", "ç´ æ•°åˆ¤å®š"],
                formulas: ["GCD(a,b) = GCD(b, a mod b)", "Sn = n(a1+an)/2"],
                trivia: "é«˜æ–¯åœ¨å°å­¦æ—¶å°±ç”¨ç­‰å·®æ•°åˆ—æ±‚å’Œå…¬å¼å¿«é€Ÿå®Œæˆäº†1åŠ åˆ°100çš„ä½œä¸šã€‚"
            },
            {
                id: 2, name: "ç­‘åŸºæœŸ", title: "é«˜ç­‰æ•°å­¦", color: "#10b981",
                desc: "è¸å…¥é«˜ç­‰æ•°å­¦çš„é—¨æ§›ã€‚å¾®ç§¯åˆ†ã€çº¿æ€§ä»£æ•°ã€æ¦‚ç‡è®ºæ˜¯æ„ç­‘ç°ä»£ç§‘å­¦çš„ä¸‰æ ¹æ”¯æŸ±ã€‚",
                concepts: ["å¾®ç§¯åˆ†åŸºç¡€", "æé™ç†è®º", "çŸ©é˜µè¿ç®—", "æ¦‚ç‡åˆ†å¸ƒ"],
                formulas: ["lim(xâ†’0) sin(x)/x = 1", "âˆ«f(x)dx = F(b)-F(a)"],
                trivia: "ç‰›é¡¿å’Œè±å¸ƒå°¼èŒ¨åœ¨å¤§çº¦åŒä¸€æ—¶é—´ç‹¬ç«‹å‘æ˜äº†å¾®ç§¯åˆ†ã€‚"
            },
            {
                id: 3, name: "é‡‘ä¸¹æœŸ", title: "çº¿æ€§ä»£æ•°ä¸å¤å˜å‡½æ•°", color: "#a78bfa",
                desc: "åœ¨å¤šç»´ç©ºé—´ä¸­ç©¿æ¢­ï¼Œç†è§£çŸ©é˜µçš„æœ¬è´¨ã€‚å¤å˜å‡½æ•°æ­ç¤ºäº†å®æ•°ä¹‹å¤–çš„å¹¿é˜”å¤©åœ°ã€‚",
                concepts: ["ç‰¹å¾å€¼/ç‰¹å¾å‘é‡", "å¤å¹³é¢", "æŸ¯è¥¿ç§¯åˆ†", "å‚…é‡Œå¶å˜æ¢"],
                formulas: ["det(A - Î»I) = 0", "e^(iÏ€) + 1 = 0"],
                trivia: "æ¬§æ‹‰å…¬å¼ e^(iÏ€)+1=0 è¢«èª‰ä¸ºæ•°å­¦ä¸­æœ€ç¾çš„å…¬å¼ã€‚"
            },
            {
                id: 4, name: "å…ƒå©´æœŸ", title: "æŠ½è±¡ä»£æ•°", color: "#fbbf24",
                desc: "ä¸å†å±€é™äºå…·ä½“çš„æ•°å­—ï¼Œè€Œæ˜¯ç ”ç©¶ä»£æ•°ç»“æ„ã€‚ç¾¤ã€ç¯ã€åŸŸã€æ¨¡ï¼Œè¿™æ˜¯çœŸæ­£çš„æ•°å­¦å®¶è¯­è¨€ã€‚",
                concepts: ["ç¾¤è®º", "ç¯ä¸åŸŸ", "ä¼½ç½—ç“¦ç†è®º", "åŒæ€ä¸åŒæ„"],
                formulas: ["ç¾¤å…¬ç† (å°é—­/ç»“åˆ/å•ä½/é€†å…ƒ)", "a^n = e"],
                trivia: "ä¼½ç½—ç“¦åœ¨20å²æ—¶æ­»äºå†³æ–—ï¼Œä½†ä»–ç”Ÿå‰å‘å±•å‡ºçš„ç¾¤è®ºå½»åº•æ”¹å˜äº†ä»£æ•°å­¦ã€‚"
            },
            {
                id: 5, name: "åŒ–ç¥æœŸ", title: "æ‹“æ‰‘ä¸å‡ ä½•", color: "#f87171",
                desc: "å½¢çŠ¶çš„æœ¬è´¨æ˜¯ä»€ä¹ˆï¼Ÿåœ¨æ‹“æ‰‘å­¦å®¶çœ¼ä¸­ï¼Œå’–å•¡æ¯å’Œç”œç”œåœˆæ˜¯ä¸€æ ·çš„ã€‚",
                concepts: ["ç‚¹é›†æ‹“æ‰‘", "åŒä¼¦ä¸åŒè°ƒ", "å¾®åˆ†æµå½¢", "çº¤ç»´ä¸›"],
                formulas: ["Ï‡ = V - E + F (æ¬§æ‹‰ç¤ºæ€§æ•°)", "âˆ«M dÏ‰ = âˆ«âˆ‚M Ï‰"],
                trivia: "åºåŠ è±çŒœæƒ³æ›¾å›°æ‰°æ•°å­¦ç•Œç™¾å¹´ã€‚"
            },
            {
                id: 6, name: "ç‚¼è™šæœŸ", title: "æ•°è®ºä¸ä»£æ•°å‡ ä½•", color: "#c084fc",
                desc: "æ•´æ•°æœ€çº¯ç²¹çš„ç¾ã€‚æ¤­åœ†æ›²çº¿ã€æ¨¡å½¢å¼ã€ä»£æ•°ç°‡ï¼Œè¿™é‡Œæ˜¯ç°ä»£å¯†ç å­¦çš„é’¥åŒ™ã€‚",
                concepts: ["æ¤­åœ†æ›²çº¿", "æ¨¡å½¢å¼", "ä»£æ•°ç°‡", "ç±»åŸŸè®º"],
                formulas: ["yÂ² = xÂ³ + ax + b", "L(s, Ï‡)"],
                trivia: "æ€€å°”æ–¯è¯æ˜è´¹é©¬å¤§å®šç†ç”¨äº†é•¿è¾¾7å¹´çš„æ—¶é—´ã€‚"
            },
            {
                id: 7, name: "åˆä½“æœŸ", title: "æœ—å…°å…¹çº²é¢†", color: "#fb7185",
                desc: "æ•°å­¦çš„å¤§ç»Ÿä¸€ç†è®ºé›å½¢ã€‚è¯•å›¾å»ºç«‹æ•°è®ºã€ä»£æ•°å‡ ä½•ä¸è¡¨ç¤ºè®ºä¹‹é—´çš„æ¡¥æ¢ã€‚",
                concepts: ["è‡ªå®ˆè¡¨ç¤º", "Galoisè¡¨ç¤º", "L-å‡½æ•°", "å‡½å­æ€§"],
                formulas: ["æœ—å…°å…¹å¯¹åº”", "è¿¹å…¬å¼"],
                trivia: "æœ—å…°å…¹çº²é¢†è¢«è®¤ä¸ºæ˜¯21ä¸–çºªæœ€é‡è¦çš„æ•°å­¦ç ”ç©¶æ–¹å‘ä¹‹ä¸€ã€‚"
            },
            {
                id: 8, name: "å¤§ä¹˜æœŸ", title: "åƒç¦§å¹´éš¾é¢˜", color: "#eab308",
                desc: "ç«™åœ¨äººç±»æ™ºæ…§çš„æœ€å‰æ²¿ã€‚P vs NPã€çº³ç»´-æ–¯æ‰˜å…‹æ–¯æ–¹ç¨‹ï¼Œè§£å¼€ä¸€ä¸ªå³å¯åå‚é’å²ã€‚",
                concepts: ["P vs NP", "Navier-Stokes", "HodgeçŒœæƒ³", "BSDçŒœæƒ³"],
                formulas: ["P = NP ?", "Navier-Stokes å­˜åœ¨æ€§ä¸å…‰æ»‘æ€§"],
                trivia: "å…‹é›·æ•°å­¦ç ”ç©¶æ‰€è®¾ç«‹äº†7ä¸ªåƒç¦§å¹´å¤§å¥–éš¾é¢˜ï¼Œæ¯é¢˜æ‚¬èµ100ä¸‡ç¾å…ƒã€‚"
            },
            {
                id: 9, name: "æ¸¡åŠ«æœŸ", title: "ç»ˆæä¹‹è°œ", color: "#ec4899",
                desc: "æ•°å­¦çš„è¾¹ç•Œã€‚é»æ›¼çŒœæƒ³å…³äºç´ æ•°çš„å¥¥ç§˜ï¼Œè¿ç»­ç»Ÿå‡è®¾å…³äºæ— ç©·çš„å±‚çº§ã€‚",
                concepts: ["é»æ›¼çŒœæƒ³", "è¿ç»­ç»Ÿå‡è®¾", "å¤§åŸºæ•°å…¬ç†", "æ•°å­¦åŸºç¡€æ‚–è®º"],
                formulas: ["Î¶(s) = Î£(1/n^s)", "2^(â„µ0) = ?"],
                trivia: "é»æ›¼çŒœæƒ³è‡³ä»Šæœªè§£ï¼Œæ˜¯å½“ä»Šçº¯æ•°å­¦é¢†åŸŸæœ€é‡è¦çš„éš¾é¢˜ã€‚"
            }
        ];

        const quizBank = [
            { level: 1, q: "è®¡ç®—: 15 + 6 Ã— 8 - 4 = ?", opts: ["59", "64", "118", "44"], ans: 0 },
            { level: 2, q: "æé™: lim (xâ†’0) (sin x) / x = ?", opts: ["1", "0", "âˆ", "ä¸å­˜åœ¨"], ans: 0 },
            { level: 3, q: "çŸ©é˜µ [[2,0],[0,3]] çš„ç‰¹å¾å€¼æ˜¯å¤šå°‘ï¼Ÿ", opts: ["2å’Œ3", "0å’Œ5", "1å’Œ4", "æ— æ³•ç¡®å®š"], ans: 0 },
            { level: 4, q: "ä»¥ä¸‹å“ªä¸ªé›†åˆåœ¨ä¹˜æ³•ä¸‹æ„æˆç¾¤ï¼Ÿ", opts: ["éé›¶æœ‰ç†æ•°", "æ‰€æœ‰æ•´æ•°", "æ‰€æœ‰è‡ªç„¶æ•°", "æ‰€æœ‰å®æ•°"], ans: 0 },
            { level: 5, q: "æ¬§æ‹‰ç¤ºæ€§æ•° V - E + F å¯¹äºçƒé¢ç­‰äºï¼Ÿ", opts: ["2", "0", "1", "-1"], ans: 0 },
            { level: 6, q: "è´¹é©¬å¤§å®šç†è¢«è¯æ˜ç”¨äº†ä»€ä¹ˆå·¥å…·ï¼Ÿ", opts: ["æ¤­åœ†æ›²çº¿ä¸æ¨¡å½¢å¼", "å¾®ç§¯åˆ†", "æ¬§å‡ é‡Œå¾—å‡ ä½•", "æ¦‚ç‡è®º"], ans: 0 },
            { level: 7, q: "æœ—å…°å…¹çº²é¢†çš„ä¸»è¦ç›®æ ‡æ˜¯è¿æ¥å“ªä¸¤ä¸ªé¢†åŸŸï¼Ÿ", opts: ["æ•°è®ºä¸è¡¨ç¤ºè®º", "å‡ ä½•ä¸ä»£æ•°", "ç‰©ç†ä¸æ•°å­¦", "é€»è¾‘ä¸è®¡ç®—"], ans: 0 },
            { level: 8, q: "P vs NP é—®é¢˜é—®çš„æ˜¯ä»€ä¹ˆï¼Ÿ", opts: ["å¤æ‚é—®é¢˜çš„å¿«é€ŸéªŒè¯æ˜¯å¦ç­‰ä»·äºå¿«é€Ÿæ±‚è§£", "å¤šé¡¹å¼æ—¶é—´é—®é¢˜", "éç¡®å®šæ€§å›¾çµæœº", "è´¨æ•°åˆ†å¸ƒè§„å¾‹"], ans: 0 },
            { level: 9, q: "é»æ›¼çŒœæƒ³å…³äºä»€ä¹ˆçš„æ ¸å¿ƒé—®é¢˜ï¼Ÿ", opts: ["é»æ›¼Î¶å‡½æ•°é›¶ç‚¹çš„åˆ†å¸ƒ", "åœ†å‘¨ç‡çš„å°½å¤´", "å®‡å®™çš„å½¢çŠ¶", "æ—¶é—´æ—…è¡Œ"], ans: 0 }
        ];

        let userState = {
            exp: 0,
            level: 1,
            unlockedLevels: [1],
            correctCount: 0,
            gamesPlayed: 0
        };

        // ================= åˆå§‹åŒ– =================
        window.onload = function() {
            loadState();
            initCanvas();
            renderRealms();
            renderChallengeList();
            animateStats();
            updateUI();
        };

        // ================= åŠ¨æ€èƒŒæ™¯å¼•æ“ =================
        function initCanvas() {
            const canvas = document.getElementById('canvas-bg');
            const ctx = canvas.getContext('2d');
            
            let width, height;
            let particles = [];
            
            function resize() {
                width = canvas.width = window.innerWidth;
                height = canvas.height = window.innerHeight;
            }
            resize();
            window.addEventListener('resize', resize);

            // åˆå§‹åŒ–ç²’å­
            for(let i=0; i<60; i++) {
                particles.push({
                    x: Math.random() * width,
                    y: Math.random() * height,
                    vx: (Math.random() - 0.5) * 0.5,
                    vy: (Math.random() - 0.5) * 0.5,
                    size: Math.random() * 2 + 1,
                    color: `rgba(${Math.random()*50+200}, ${Math.random()*50+100}, ${Math.random()*50}, ${Math.random()*0.5 + 0.2})`
                });
            }

            function draw() {
                ctx.clearRect(0, 0, width, height);
                
                // æ›´æ–°ç²’å­ä½ç½®
                particles.forEach(p => {
                    p.x += p.vx;
                    p.y += p.vy;

                    // è¾¹ç•Œåå¼¹
                    if(p.x < 0 || p.x > width) p.vx *= -1;
                    if(p.y < 0 || p.y > height) p.vy *= -1;

                    ctx.beginPath();
                    ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                    ctx.fillStyle = p.color;
                    ctx.fill();
                });

                // ç»˜åˆ¶è¿çº¿
                ctx.strokeStyle = 'rgba(245, 158, 11, 0.05)';
                ctx.lineWidth = 1;
                for(let i=0; i<particles.length; i++) {
                    for(let j=i+1; j<particles.length; j++) {
                        const dx = particles[i].x - particles[j].x;
                        const dy = particles[i].y - particles[j].y;
                        const dist = Math.sqrt(dx*dx + dy*dy);
                        
                        if(dist < 150) {
                            ctx.beginPath();
                            ctx.moveTo(particles[i].x, particles[i].y);
                            ctx.lineTo(particles[j].x, particles[j].y);
                            ctx.stroke();
                        }
                    }
                }
                requestAnimationFrame(draw);
            }
            draw();
        }

        // ================= åŠ¨ç”»æ•ˆæœ =================
        function animateStats() {
            const targets = { 
                'stat-realms': 9, 
                'stat-problems': 7, // åƒç¦§å¹´éš¾é¢˜
                'stat-players': 2333 // æ¨¡æ‹Ÿæ•°æ®
            };

            Object.keys(targets).forEach(id => {
                const el = document.getElementById(id);
                if(!el) return;
                let current = 0;
                const step = targets[id] / 50;
                const timer = setInterval(() => {
                    current += step;
                    if(current >= targets[id]) {
                        el.innerText = targets[id];
                        clearInterval(timer);
                    } else {
                        el.innerText = Math.floor(current);
                    }
                }, 30);
            });
        }

        // ================= æ¸²æŸ“å‡½æ•° =================
        function renderRealms() {
            const container = document.getElementById('realm-container');
            container.innerHTML = '';
            
            mathData.forEach((realm, index) => {
                const card = document.createElement('div');
                card.className = 'realm-card rounded-xl p-6 cursor-pointer';
                card.style.borderLeft = `4px solid ${realm.color}`;
                card.style.animationDelay = `${index * 0.1}s`;
                
                card.onclick = () => showRealmDetail(realm);
                
                card.innerHTML = `
                    <div class="flex justify-between items-start mb-3">
                        <h3 class="text-xl font-bold" style="color: ${realm.color}; font-family: 'Ma Shan Zheng', cursive;">${realm.name}</h3>
                        <span class="text-xs bg-slate-900 px-2 py-1 rounded border border-slate-700">${realm.title}</span>
                    </div>
                    <p class="text-slate-400 text-sm mb-4 line-clamp-3 h-12">${realm.desc}</p>
                    <div class="flex flex-wrap gap-2 mb-4">
                        ${realm.concepts.slice(0,3).map(c => `<span class="text-xs bg-slate-800/50 px-2 py-1 rounded text-slate-300 border border-slate-700">${c}</span>`).join('')}
                    </div>
                    <div class="text-right text-xs text-amber-500 opacity-80 hover:opacity-100 transition-opacity flex items-center justify-end gap-1">
                        æŸ¥çœ‹è¯¦æƒ… <span>â†’</span>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function renderChallengeList() {
            const container = document.getElementById('challenge-list');
            container.innerHTML = '';
            
            mathData.forEach((realm) => {
                const isUnlocked = userState.unlockedLevels.includes(realm.id);
                const card = document.createElement('div');
                card.className = `rounded-xl p-6 border transition-all duration-500 ${isUnlocked ? 'bg-slate-800/50 border-amber-500/30 hover:bg-slate-800' : 'bg-slate-900/50 border-slate-700 opacity-50'}`;
                
                card.innerHTML = `
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="text-lg font-bold" style="color: ${isUnlocked ? realm.color : '#64748b'}">${realm.name} Â· è¯•ç‚¼</h3>
                        ${!isUnlocked ? '<span class="text-xs text-red-400">ğŸ”’ éœ€é€šå…³å‰ä¸€å…³</span>' : '<span class="text-xs text-green-400">å¯æŒ‘æˆ˜</span>'}
                    </div>
                    <p class="text-slate-400 text-sm mb-4">éš¾åº¦: ${realm.title}</p>
                    ${isUnlocked ? 
                        `<button onclick="startQuiz(${realm.id})" class="w-full py-2 bg-gradient-to-r from-indigo-500 to-purple-600 rounded text-white font-bold text-sm hover:shadow-lg hover:shadow-indigo-500/30 transition-all active:scale-95">
                            å¼€å§‹æŒ‘æˆ˜ (+${realm.id * 10} ä¿®ä¸º)
                        </button>` :
                        `<button disabled class="w-full py-2 bg-slate-700 rounded text-slate-500 font-bold text-sm cursor-not-allowed">
                            æœªè§£é”
                        </button>`
                    }
                `;
                container.appendChild(card);
            });
        }

        // ================= äº¤äº’é€»è¾‘ =================
        function navigateTo(pageId) {
            document.querySelectorAll('.page-section').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            
            document.getElementById(pageId).classList.add('active');
            window.scrollTo(0, 0);

            const navMap = { 'home': 0, 'realms': 1, 'challenge': 2, 'games': 3 };
            const navItems = document.querySelectorAll('.nav-item');
            if(navMap[pageId] !== undefined && navItems[navMap[pageId]]) {
                navItems[navMap[pageId]].classList.add('active');
            }
        }

        function showRealmDetail(realm) {
            const body = document.getElementById('modal-detail-body');
            body.innerHTML = `
                <div class="border-b border-slate-700 pb-4 mb-4">
                    <h2 class="text-3xl font-bold mb-1" style="color: ${realm.color}; font-family: 'Ma Shan Zheng', cursive;">${realm.name}</h2>
                    <span class="text-sm text-slate-400">${realm.title}</span>
                </div>
                
                <p class="text-slate-300 leading-relaxed mb-6 text-md">${realm.desc}</p>
                
                <div class="grid md:grid-cols-2 gap-6 mb-6">
                    <div class="bg-slate-900/80 p-4 rounded-lg border border-slate-700">
                        <h4 class="text-amber-400 font-bold mb-3">æ ¸å¿ƒå¿ƒæ³•</h4>
                        <ul class="space-y-2">
                            ${realm.concepts.map(c => `<li class="text-slate-300 text-sm flex items-center gap-2"><span class="w-1.5 h-1.5 bg-amber-400 rounded-full"></span>${c}</li>`).join('')}
                        </ul>
                    </div>
                    
                    <div class="bg-slate-900/80 p-4 rounded-lg border border-slate-700">
                        <h4 class="text-cyan-400 font-bold mb-3">ç»å…¸å…¬å¼</h4>
                        <div class="space-y-3 font-mono text-sm">
                            ${realm.formulas.map(f => `<div class="text-cyan-300 bg-slate-800 p-2 rounded">${f}</div>`).join('')}
                        </div>
                    </div>
                </div>
                
                <div class="mt-6 bg-amber-500/5 border-l-4 border-amber-500 p-4 rounded">
                    <p class="text-amber-400 italic text-sm">"${realm.trivia}"</p>
                </div>
                
                <div class="mt-6 flex justify-end gap-4">
                    <button onclick="closeModal('modal-detail')" class="px-4 py-2 text-slate-400 hover:text-white transition-colors">å…³é—­</button>
                    <button onclick="closeModal('modal-detail'); navigateTo('challenge');" class="px-4 py-2 bg-indigo-600 hover:bg-indigo-500 rounded text-white transition-colors active:scale-95">å»æŒ‘æˆ˜æ­¤å¢ƒç•Œ</button>
                </div>
            `;
            document.getElementById('modal-detail').classList.add('active');
        }

        function startQuiz(levelId) {
            const questions = quizBank.filter(q => q.level === levelId);
            if(questions.length === 0) return alert("è¯¥å¢ƒç•Œæš‚æ— é¢˜åº“ï¼");
            
            const q = questions[Math.floor(Math.random() * questions.length)];
            const realm = mathData.find(r => r.id === levelId);
            
            const body = document.getElementById('modal-quiz-body');
            body.innerHTML = `
                <div class="text-center mb-6">
                    <h3 class="text-xl font-bold" style="color: ${realm.color}">${realm.name} Â· è¯•ç‚¼</h3>
                </div>
                <div class="bg-slate-900/50 p-4 rounded-lg mb-6">
                    <p class="text-lg">${q.q}</p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                    ${q.opts.map((opt, i) => `
                        <button onclick="handleAnswer(${i}, ${q.ans}, ${levelId})" class="w-full p-3 bg-slate-700 hover:bg-slate-600 rounded text-left transition-colors active:scale-95">
                            <span class="inline-block w-6 h-6 rounded bg-slate-900 text-center mr-2">${['A','B','C','D'][i]}</span>
                            ${opt}
                        </button>
                    `).join('')}
                </div>
            `;
            document.getElementById('modal-quiz').classList.add('active');
        }

        function handleAnswer(selected, correct, levelId) {
            const modal = document.getElementById('modal-quiz');
            const body = document.getElementById('modal-quiz-body');
            
            if(selected === correct) {
                const expGain = levelId * 10;
                userState.exp += expGain;
                userState.correctCount++;
                
                if(!userState.unlockedLevels.includes(levelId + 1) && levelId < 9) {
                    userState.unlockedLevels.push(levelId + 1);
                }
                
                body.innerHTML = `
                    <div class="text-center">
                        <div class="text-6xl mb-4">âœ¨</div>
                        <h3 class="text-2xl font-bold text-green-400 mb-2">é“å¿ƒé€šæ˜</h3>
                        <p class="text-slate-300 mb-6">å›ç­”æ­£ç¡®ï¼ä¿®ä¸º +${expGain}</p>
                        <button onclick="closeModal('modal-quiz'); updateUI();" class="px-6 py-2 bg-green-600 rounded hover:bg-green-500 transition-colors">ç»§ç»­ä¿®ç‚¼</button>
                    </div>
                `;
            } else {
                body.innerHTML = `
                    <div class="text-center">
                        <div class="text-6xl mb-4">â˜ï¸</div>
                        <h3 class="text-2xl font-bold text-red-400 mb-2">å¿ƒé­”å…¥ä¾µ</h3>
                        <p class="text-slate-300 mb-6">å›ç­”é”™è¯¯ï¼Œå†æ¥å†å‰ã€‚</p>
                        <button onclick="closeModal('modal-quiz');" class="px-6 py-2 bg-slate-700 rounded hover:bg-slate-600 transition-colors">é‡æ–°é—­å…³</button>
                    </div>
                `;
            }
            saveState();
        }

        function closeModal(id) {
            document.getElementById(id).classList.remove('active');
        }

        document.querySelectorAll('.modal').forEach(m => {
            m.addEventListener('click', e => {
                if(e.target === m) closeModal(m.id);
            });
        });

        // ================= å°æ¸¸æˆ =================
        function startGame(type) {
            const area = document.getElementById('game-area');
            area.classList.remove('hidden');
            userState.gamesPlayed++;
            saveState();
            
            if(type === 'puzzle') {
                const formulas = ["e^(iÏ€)+1=0", "aÂ²+bÂ²=cÂ²", "E=mcÂ²"];
                const target = formulas[Math.floor(Math.random()*formulas.length)];
                const chars = target.split('').sort(() => Math.random() - 0.5);
                
                area.innerHTML = `
                    <div class="bg-slate-800/80 rounded-xl p-6 border border-amber-500/30 shadow-lg">
                        <h3 class="text-xl font-bold text-amber-400 mb-4">å…¬å¼æ‹¼å›¾ï¼šè¯·è¿˜åŸå› å…¬å¼</h3>
                        <div id="puzzle-target" class="min-h-[50px] bg-slate-900 p-2 rounded mb-4 flex flex-wrap gap-2 border border-dashed border-slate-600"></div>
                        <div id="puzzle-source" class="flex flex-wrap gap-2 justify-center mb-4">
                            ${chars.map(c => `<button class="px-3 py-1 bg-slate-700 rounded hover:bg-amber-500/30 transition-colors active:scale-90" onclick="movePuzzle(this)">${c}</button>`).join('')}
                        </div>
                        <div class="text-center">
                            <button onclick="checkPuzzle('${target}')" class="px-6 py-2 bg-amber-500 text-slate-900 rounded font-bold active:scale-95">ç¡®è®¤</button>
                        </div>
                    </div>
                `;
            } else if(type === 'sequence') {
                const seqs = [
                    {arr: [1, 1, 2, 3, 5], ans: 8, hint: "æ–æ³¢é‚£å¥‘"},
                    {arr: [2, 4, 8, 16, 32], ans: 64, hint: "2çš„å¹‚"}
                ];
                const game = seqs[Math.floor(Math.random()*seqs.length)];
                
                area.innerHTML = `
                    <div class="bg-slate-800/80 rounded-xl p-6 border border-blue-500/30 shadow-lg">
                        <h3 class="text-xl font-bold text-blue-400 mb-4">æ•°åˆ—æ¨æ¼”</h3>
                        <p class="text-slate-300 mb-4">æç¤º: ${game.hint}</p>
                        <div class="text-2xl tracking-widest mb-6 text-center font-mono text-white">${game.arr.join(' , ')} , ?</div>
                        <input id="seq-answer" type="number" class="w-full p-2 bg-slate-900 rounded border border-slate-600 mb-4" placeholder="è¾“å…¥ä¸‹ä¸€ä¸ªæ•°å­—">
                        <div class="text-center">
                            <button onclick="checkSeq(${game.ans})" class="px-6 py-2 bg-blue-500 text-white rounded font-bold active:scale-95">æäº¤</button>
                        </div>
                    </div>
                `;
            }
            updateUI();
        }

        function movePuzzle(btn) {
            const target = document.getElementById('puzzle-target');
            const source = document.getElementById('puzzle-source');
            if(btn.parentElement.id === 'puzzle-source') target.appendChild(btn);
            else source.appendChild(btn);
        }
        
        function checkPuzzle(target) {
            const current = Array.from(document.getElementById('puzzle-target').querySelectorAll('button')).map(b => b.innerText).join('');
            if(current === target) {
                gainExp(20, "æ‹¼å›¾æ­£ç¡®ï¼");
                document.getElementById('game-area').classList.add('hidden');
            } else {
                alert("é¡ºåºä¸å¯¹å“¦");
            }
        }
        
        function checkSeq(ans) {
            const val = document.getElementById('seq-answer').value;
            if(parseInt(val) === ans) {
                gainExp(15, "æ¨æ¼”æ­£ç¡®ï¼");
                document.getElementById('game-area').classList.add('hidden');
            } else {
                alert("å†æƒ³æƒ³");
            }
        }

        function gainExp(amount, msg) {
            userState.exp += amount;
            saveState();
            updateUI();
            alert(`âœ¨ ${msg} ä¿®ä¸º +${amount}`);
        }

        // ================= å·¥å…·å‡½æ•° =================
        function updateUI() {
            userState.level = 1 + Math.floor(userState.exp / 100);
            
            document.getElementById('nav-level').innerText = userState.level;
            document.getElementById('profile-level').innerText = userState.level;
            document.getElementById('stat-correct').innerText = userState.correctCount;
            document.getElementById('stat-games').innerText = userState.gamesPlayed;
            
            const nextExp = userState.level * 100;
            document.getElementById('profile-exp-text').innerText = `${userState.exp} / ${nextExp}`;
            document.getElementById('profile-exp-bar').style.width = `${(userState.exp % 100)}%`;
            
            renderChallengeList();
        }

        function saveState() {
            localStorage.setItem('math_cultivation_v3', JSON.stringify(userState));
        }

        function loadState() {
            const saved = localStorage.getItem('math_cultivation_v3');
            if(saved) userState = JSON.parse(saved);
        }
    </script>
</body>
</html>
